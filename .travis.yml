dist: trusty
sudo: true

matrix:
  include:
    - os: osx
      env: TARGET=x86_64-apple-darwin RID=osx-x64
    - os: linux
      env: TARGET=x86_64-unknown-linux-gnu RID=linux-x64

install:
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install glib cairo libexif; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -y libgif-dev xvfb; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -y git autoconf libtool automake build-essential mono-devel gettext cmake; fi

script:
# Build libgdiplus
- cd $HOME/build/CoreCompat/libgdiplus
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then ./autogen.sh --prefix=/usr/; fi
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then ./autogen.sh --without-x11 --prefix=/usr/; fi
- make
- make check
- sudo make install

# Build Mono
- cd $HOME/build/
- git clone --depth 1 https://github.com/mono/mono
- cd $HOME/build/mono
- ./autogen.sh
- make > /dev/null

# Run the System.Drawing and System.Windows.Forms tests.
# System.Windows.Forms test don't currently pass on macOS.
- cd mcs/class/System.Drawing
- make check
- cd ../System.Windows.Forms
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then xvfb-run make check; fi
