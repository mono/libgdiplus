dist: trusty

matrix:
  include:
    - os: osx
    - os: linux

install:
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install glib cairo libexif; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -y libgif-dev xvfb; fi
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -y git autoconf libtool automake build-essential gettext cmake; fi

script:
# Build libgdiplus
- cd $HOME/build/CoreCompat/libgdiplus
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then ./autogen.sh --prefix=/usr/local/; fi
- if [ "$TRAVIS_OS_NAME" = "osx" ]; then ./autogen.sh --without-x11 --prefix=/usr/local/; fi
- make -j4
- make check
- sudo make install

# Build Mono
- cd $HOME/build/
- git clone --depth 1 https://github.com/mono/mono
- cd $HOME/build/mono
- ./autogen.sh --prefix=/usr/local/
- make -j4 > /dev/null

# Run the System.Drawing and System.Windows.Forms tests.
# System.Windows.Forms test don't currently pass on macOS.
- cd mcs/class/System.Drawing
- make check
- cd ../System.Windows.Forms
- if [ "$TRAVIS_OS_NAME" = "linux" ]; then xvfb-run make check; fi
